<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DPP Datafl√∂de</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div id="root"></div>
    <script type="text/babel">
        function DataReuseVisualization() {
            const [activeCategory, setActiveCategory] = React.useState(null);
            const [activeFas, setActiveFas] = React.useState('fas1');

            const categories = [
                {
                    id: 'once',
                    title: 'üîí Registrera en g√•ng',
                    subtitle: 'Master data - √•teranv√§nds √∂verallt',
                    color: 'bg-green-100 border-green-500',
                    headerColor: 'bg-green-500',
                    fas1: true,
                    fas2: true,
                    items: [
                        { table: 'brands', desc: 'Varum√§rken (med API-nyckel)', example: 'V√•rdTex Pro' },
                        { table: 'suppliers', desc: 'Fabriker (med API-nyckel)', example: 'T√™xtil Hospitalar Porto' },
                        { table: 'brand_suppliers', desc: 'Relationer mellan varum√§rke och fabrik', example: 'V√•rdTex ‚Üî Porto' },
                    ]
                },
                {
                    id: 'material',
                    title: 'üßµ Registrera per tyg',
                    subtitle: 'Fabrikens tyglager - v√§lj vid produktion',
                    color: 'bg-blue-100 border-blue-500',
                    headerColor: 'bg-blue-500',
                    fas1: true,
                    fas2: true,
                    items: [
                        { table: 'factory_materials', desc: 'Tygtyp', example: 'PolyCotton 65/35 155gsm' },
                        { table: '‚Ü≥ compositions', desc: 'Fiberinneh√•ll', example: '65% Polyester, 35% Bomull' },
                        { table: '‚Ü≥ certifications', desc: 'Certifikat', example: 'Oeko-Tex Class I' },
                        { table: '‚Ü≥ supply_chain', desc: 'Leverant√∂rskedja', example: 'Indien ‚Üí Portugal' },
                    ]
                },
                {
                    id: 'product',
                    title: 'üëï Registrera per produkt',
                    subtitle: 'Produktstamdata - g√§ller alla storlekar/f√§rger',
                    color: 'bg-purple-100 border-purple-500',
                    headerColor: 'bg-purple-500',
                    fas1: true,
                    fas2: true,
                    items: [
                        { table: 'products', desc: 'Produktinfo', example: 'Scrubs Tunika' },
                        { table: '‚Ü≥ products.gtin', desc: 'üì± QR-kodens k√§lla', example: '7350012345001', highlight: 'qr' },
                        { table: '‚Ü≥ products.data_carrier_*', desc: 'Datab√§rartyp & placering', example: 'QR, care_label, neck' },
                        { table: '‚Ü≥ care_information', desc: 'Sk√∂tselr√•d', example: 'Industritv√§tt 85¬∞C' },
                        { table: '‚Ü≥ compliance_information', desc: 'SVHC, mikrofiber', example: 'Nej / Ja' },
                        { table: '‚Ü≥ certifications', desc: 'Produktcertifikat', example: 'Oeko-Tex' },
                        { table: '‚Ü≥ circularity_information', desc: '√Ötervinning', example: 'Returnera till tv√§tten' },
                        { table: '‚Ü≥ sustainability_information', desc: 'H√•llbarhetstext', example: 'CO2-avtryck' },
                    ]
                },
                {
                    id: 'variant',
                    title: 'üìè Registrera per variant',
                    subtitle: 'Storlek + F√§rg kombination',
                    color: 'bg-yellow-100 border-yellow-500',
                    headerColor: 'bg-yellow-500',
                    fas1: true,
                    fas2: true,
                    items: [
                        { table: 'product_variants', desc: 'SKU', example: 'VT-SCR-TOP-001-CBL-M' },
                        { table: '', desc: 'Storlek', example: 'M' },
                        { table: '', desc: 'F√§rg', example: 'Ceil Blue' },
                    ]
                },
                {
                    id: 'batch',
                    title: 'üì¶ Ny per produktionsorder',
                    subtitle: 'Skapas vid varje best√§llning',
                    color: 'bg-orange-100 border-orange-500',
                    headerColor: 'bg-orange-500',
                    fas1: true,
                    fas2: true,
                    items: [
                        { table: 'batches', desc: 'Batchnummer, PO, datum, antal', example: 'BATCH-2025-VGR-001' },
                        { table: '‚Ü≥ batch_materials', desc: '‚Üí V√§lj tyg fr√•n lager', example: '‚Üí PolyCotton 65/35' },
                        { table: '‚Ü≥ batch_suppliers', desc: '‚Üí V√§lj fabrik', example: '‚Üí Porto' },
                    ]
                },
                {
                    id: 'item',
                    title: 'üè∑Ô∏è Unik per plagg (RFID)',
                    subtitle: 'Varje fysisk artikel f√•r serienummer',
                    color: 'bg-red-100 border-red-500',
                    headerColor: 'bg-red-500',
                    fas1: false,
                    fas2: true,
                    items: [
                        { table: 'items.sgtin', desc: 'üì° RFID-serienummer', example: '7350012345001.00001', highlight: 'rfid' },
                        { table: '‚Ü≥ items.tid', desc: 'Fysiskt tagg-ID (EPC)', example: '3034257BF400...' },
                    ]
                },
            ];

            const fasInfo = {
                fas1: {
                    title: 'Fas 1 - QR-kod / Modellniv√•',
                    description: 'DPP per produkttyp. Samma QR-kod f√∂r alla plagg av samma modell.',
                    identifier: 'GTIN fr√•n products.gtin',
                    dppUrl: '/dpp/product/{GTIN}',
                    example: '/dpp/product/7350012345001',
                    timeline: '2027-2028',
                    icon: 'üì±'
                },
                fas2: {
                    title: 'Fas 2 - RFID / Artikelniv√•',
                    description: 'DPP per plagg. Varje fysiskt plagg har unikt serienummer.',
                    identifier: 'SGTIN fr√•n items.sgtin',
                    dppUrl: '/dpp/item/{sgtin}',
                    example: '/dpp/item/7350012345001.00001',
                    timeline: '2028-2029',
                    icon: 'üì°'
                }
            };

            const currentFas = fasInfo[activeFas];
            const filteredCategories = categories.filter(cat => cat[activeFas]);

            return (
                <div className="p-4 max-w-4xl mx-auto">
                    {/* Navigation */}
                    <a href="../test.php" className="text-blue-600 hover:text-blue-800 mb-4 inline-block">
                        ‚Üê Tillbaka till testpanelen
                    </a>

                    <h1 className="text-2xl font-bold mb-2">DPP Datafl√∂de</h1>
                    <p className="text-gray-600 mb-4">Registrera en g√•ng ‚Üí √Öteranv√§nd vid produktion</p>

                    {/* Fas-v√§ljare */}
                    <div className="flex gap-2 mb-6">
                        <button
                            onClick={() => setActiveFas('fas1')}
                            className={`px-4 py-2 rounded-lg font-medium transition flex items-center gap-2 ${
                                activeFas === 'fas1'
                                    ? 'bg-blue-600 text-white'
                                    : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                            }`}
                        >
                            üì± Fas 1 (QR)
                        </button>
                        <button
                            onClick={() => setActiveFas('fas2')}
                            className={`px-4 py-2 rounded-lg font-medium transition flex items-center gap-2 ${
                                activeFas === 'fas2'
                                    ? 'bg-red-600 text-white'
                                    : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                            }`}
                        >
                            üì° Fas 2 (RFID)
                        </button>
                    </div>

                    {/* Fas-info med identifierare */}
                    <div className={`border-2 rounded-lg p-4 mb-6 ${activeFas === 'fas1' ? 'border-blue-400 bg-blue-50' : 'border-red-400 bg-red-50'}`}>
                        <div className="flex items-start justify-between">
                            <div>
                                <h2 className={`font-bold ${activeFas === 'fas1' ? 'text-blue-800' : 'text-red-800'}`}>
                                    {currentFas.icon} {currentFas.title}
                                </h2>
                                <p className="text-sm text-gray-600 mt-1">{currentFas.description}</p>
                            </div>
                            <div className="text-xs text-gray-500 bg-white px-2 py-1 rounded">{currentFas.timeline}</div>
                        </div>

                        {/* Identifierare och URL */}
                        <div className="mt-3 grid grid-cols-2 gap-3">
                            <div className={`p-2 rounded ${activeFas === 'fas1' ? 'bg-blue-100' : 'bg-red-100'}`}>
                                <div className={`text-xs font-bold ${activeFas === 'fas1' ? 'text-blue-600' : 'text-red-600'}`}>
                                    IDENTIFIERARE FR√ÖN
                                </div>
                                <div className="font-mono text-sm mt-1">{currentFas.identifier}</div>
                            </div>
                            <div className={`p-2 rounded ${activeFas === 'fas1' ? 'bg-blue-100' : 'bg-red-100'}`}>
                                <div className={`text-xs font-bold ${activeFas === 'fas1' ? 'text-blue-600' : 'text-red-600'}`}>
                                    DPP-URL
                                </div>
                                <div className="font-mono text-xs mt-1">{currentFas.example}</div>
                            </div>
                        </div>
                    </div>

                    {/* Kategorier */}
                    <div className="space-y-3 mb-6">
                        {filteredCategories.map((cat) => (
                            <div
                                key={cat.id}
                                className={`border-l-4 rounded-lg overflow-hidden ${cat.color}`}
                            >
                                <div
                                    className={`${cat.headerColor} text-white p-3 cursor-pointer flex justify-between items-center`}
                                    onClick={() => setActiveCategory(activeCategory === cat.id ? null : cat.id)}
                                >
                                    <div>
                                        <h3 className="font-bold">{cat.title}</h3>
                                        <p className="text-sm opacity-90">{cat.subtitle}</p>
                                    </div>
                                    <span className="text-xl">{activeCategory === cat.id ? '‚àí' : '+'}</span>
                                </div>

                                {activeCategory === cat.id && (
                                    <div className="p-3">
                                        <table className="w-full text-sm">
                                            <tbody>
                                                {cat.items.map((item, idx) => (
                                                    <tr key={idx} className={`border-b border-gray-200 last:border-0 ${
                                                        item.highlight === 'qr' ? 'bg-blue-50' :
                                                        item.highlight === 'rfid' ? 'bg-red-50' : ''
                                                    }`}>
                                                        <td className="py-2 font-mono text-gray-600 w-1/3">
                                                            {item.highlight === 'qr' && <span className="text-blue-500 mr-1">üì±</span>}
                                                            {item.highlight === 'rfid' && <span className="text-red-500 mr-1">üì°</span>}
                                                            {item.table}
                                                        </td>
                                                        <td className={`py-2 w-1/3 ${item.highlight ? 'font-medium' : ''}`}>{item.desc}</td>
                                                        <td className="py-2 text-gray-500 italic">{item.example}</td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>

                    {/* QR vs RFID fl√∂desdiagram */}
                    <div className={`rounded-lg p-4 mb-6 ${activeFas === 'fas1' ? 'bg-blue-50 border border-blue-200' : 'bg-red-50 border border-red-200'}`}>
                        <h3 className={`font-bold mb-3 ${activeFas === 'fas1' ? 'text-blue-800' : 'text-red-800'}`}>
                            {activeFas === 'fas1' ? 'üì± QR-kod fl√∂de' : 'üì° RFID fl√∂de'}
                        </h3>
                        <div className="flex items-center gap-2 text-xs flex-wrap">
                            {activeFas === 'fas1' ? (
                                <>
                                    <span className="bg-purple-500 text-white px-2 py-1 rounded">products.gtin</span>
                                    <span className="text-gray-400">‚Üí</span>
                                    <span className="bg-gray-300 px-2 py-1 rounded">QR-generator</span>
                                    <span className="text-gray-400">‚Üí</span>
                                    <span className="bg-gray-300 px-2 py-1 rounded">Etikett</span>
                                    <span className="text-gray-400">‚Üí</span>
                                    <span className="bg-gray-300 px-2 py-1 rounded">üì± Skanna</span>
                                    <span className="text-gray-400">‚Üí</span>
                                    <span className="bg-green-500 text-white px-2 py-1 rounded">/dpp/product/{'{GTIN}'}</span>
                                </>
                            ) : (
                                <>
                                    <span className="bg-orange-500 text-white px-2 py-1 rounded">batch skapas</span>
                                    <span className="text-gray-400">‚Üí</span>
                                    <span className="bg-red-500 text-white px-2 py-1 rounded">items.sgtin</span>
                                    <span className="text-gray-400">‚Üí</span>
                                    <span className="bg-gray-300 px-2 py-1 rounded">RFID-kodning</span>
                                    <span className="text-gray-400">‚Üí</span>
                                    <span className="bg-gray-300 px-2 py-1 rounded">üì° L√§s</span>
                                    <span className="text-gray-400">‚Üí</span>
                                    <span className="bg-green-500 text-white px-2 py-1 rounded">/dpp/item/{'{sgtin}'}</span>
                                </>
                            )}
                        </div>
                    </div>

                    {/* Sammanfattning */}
                    <div className="grid grid-cols-2 gap-4 mb-6">
                        <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                            <h3 className="font-bold text-green-800 mb-2">‚ôªÔ∏è Registrera en g√•ng</h3>
                            <ul className="text-sm text-green-700 space-y-1">
                                <li>‚Ä¢ Varum√§rken & fabriker</li>
                                <li>‚Ä¢ Relationer varum√§rke ‚Üî fabrik</li>
                                <li>‚Ä¢ Tyger + certifikat</li>
                                <li>‚Ä¢ Produkter + GTIN + sk√∂tselr√•d</li>
                                <li>‚Ä¢ Datab√§rartyp & placering</li>
                                <li>‚Ä¢ Varianter (SKU)</li>
                            </ul>
                        </div>
                        <div className="bg-orange-50 border border-orange-200 rounded-lg p-4">
                            <h3 className="font-bold text-orange-800 mb-2">üÜï Skapas varje g√•ng</h3>
                            <ul className="text-sm text-orange-700 space-y-1">
                                <li>‚Ä¢ Batch (per order)</li>
                                <li>‚Ä¢ Koppling batch ‚Üí tyg</li>
                                <li>‚Ä¢ Koppling batch ‚Üí fabrik</li>
                                {activeFas === 'fas2' && (
                                    <li className="font-medium text-red-700">‚Ä¢ üì° Serienummer (per plagg)</li>
                                )}
                            </ul>
                            {activeFas === 'fas1' && (
                                <p className="text-xs text-orange-500 mt-2 italic">
                                    Fas 1: Inga serienummer beh√∂vs ‚Äì QR pekar p√• GTIN
                                </p>
                            )}
                        </div>
                    </div>

                    {/* Skillnad mellan faserna */}
                    <div className="bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6">
                        <h3 className="font-bold text-amber-800 mb-2">üîÑ Skillnad Fas 1 vs Fas 2</h3>
                        <table className="w-full text-sm">
                            <thead>
                                <tr className="text-left text-amber-700">
                                    <th className="pb-2"></th>
                                    <th className="pb-2">üì± Fas 1 (QR)</th>
                                    <th className="pb-2">üì° Fas 2 (RFID)</th>
                                </tr>
                            </thead>
                            <tbody className="text-amber-900">
                                <tr className="border-t border-amber-200">
                                    <td className="py-2 font-medium">Identifierare</td>
                                    <td className="py-2 font-mono text-sm">products.gtin</td>
                                    <td className="py-2 font-mono text-sm">items.sgtin</td>
                                </tr>
                                <tr className="border-t border-amber-200">
                                    <td className="py-2 font-medium">Datab√§rare</td>
                                    <td className="py-2">QR-kod p√• etikett</td>
                                    <td className="py-2">RFID-chip insydd</td>
                                </tr>
                                <tr className="border-t border-amber-200">
                                    <td className="py-2 font-medium">DPP skapas</td>
                                    <td className="py-2">1 per produkttyp</td>
                                    <td className="py-2">1 per fysiskt plagg</td>
                                </tr>
                                <tr className="border-t border-amber-200">
                                    <td className="py-2 font-medium">items-tabell</td>
                                    <td className="py-2 text-gray-400">‚ùå Anv√§nds ej</td>
                                    <td className="py-2 text-green-700">‚úÖ sgtin + tid</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    {/* Nyckelinsikt */}
                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h3 className="font-bold text-blue-800 mb-2">üí° Nyckelinsikt</h3>
                        {activeFas === 'fas1' ? (
                            <p className="text-sm text-blue-700">
                                I Fas 1 genereras QR-koden fr√•n <code className="bg-white px-1 rounded">products.gtin</code>.
                                Du beh√∂ver bara skapa <strong>batch</strong> per order. Alla plagg av samma produkt delar samma QR och DPP.
                            </p>
                        ) : (
                            <p className="text-sm text-blue-700">
                                I Fas 2 genereras serienummer i <code className="bg-white px-1 rounded">items</code>-tabellen vid batchproduktion.
                                Varje RFID-tagg inneh√•ller ett unikt <code className="bg-white px-1 rounded">sgtin</code> som pekar p√• en individuell DPP.
                            </p>
                        )}
                    </div>

                    {/* Fas 3 disclaimer */}
                    <div className="mt-4 text-xs text-gray-400 text-center">
                        Fas 3 (livscykeldata: reparationer, √•tervinning) hanteras av hosting-plattformen ‚Äì utanf√∂r v√•rt scope.
                    </div>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<DataReuseVisualization />);
    </script>
</body>
</html>
